<!DOCTYPE html>
<html lang="id-ID">
<head>
<meta name="robots" content="noindex, nofollow"/>
<meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Web Scraping Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- Mobile Properties -->
<meta name="theme-color" content="#4774a7"/>
<meta name="msapplication-navbutton-color" content="#4774a7"/>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="#4774a7" />
<!-- Mobile Favicons -->
<meta name="application-name" content="Web Scraping Test" />
<meta name="msapplication-TileColor" content="#4774a7"/>
<link rel="icon" type="image/png" href="./favicon.png"/>
<style type='text/css'>
:root {
  --color: #eceff1;
  --color2: #f3f3f3;
  --color3: #f5f5f5;
  --color4: #37474f;
  --color5: #4774a7;
  --border: #b0bec5;
}

/* Custom Scrollbar */
::-webkit-scrollbar{width:15px;}
::-webkit-scrollbar-track{background:#1f1f1f;}
::-webkit-scrollbar-thumb{background:#333;}

*,*:before,*:after{margin:0;padding:0;-webkit-box-sizing:border-box;box-sizing:border-box;}
body{background:var(--color);color:var(--color4);font-size:16px;font-family:-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.3em;position:relative;}
body.no-scroll{overflow:hidden;}
a,a:link,a:visited{color:var(--color5);text-decoration:none;}
ol,ul{list-style:none;}
h1{font-size:150%;}
h2{font-size:120%;}
input[type=text],input[type=number],textarea,select{padding:6px 10px;background:#fbfbfb;outline:none;border-radius:2px;border:1px solid var(--border);}
input[readonly]{background:rgb(176,190,197,.5);cursor:default;}
input[disabled]{background:var(--border);}
textarea{overflow:auto;resize:vertical;}
svg{fill:currentColor;}

/* Flexbox */
.flex{display:-webkit-flex;display:flex;}
.flex_wrap{display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;}
.f_perfect{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);}/* Perfect Centering: parent */
.f_perfect .fp_content{margin:auto;}/* Perfect Centering: content */
.f_column{flex-direction:column;}
.f_top{-webkit-align-items:flex-start;align-items:flex-start;-webkit-align-content:flex-start;align-content:flex-start;}
.f_middle{-webkit-align-items:center;align-items:center;-webkit-align-content:center;align-content:center;}
.f_bottom{-webkit-align-items:flex-end;align-items:flex-end;-webkit-align-content:flex-end;align-content:flex-end;}
.f_center{-webkit-justify-content:center;justify-content:center;}
.f_left{-webkit-justify-content:flex-start;justify-content:flex-start;}
.f_right{-webkit-justify-content:flex-end;justify-content:flex-end;}
.f_grow{-webkit-flex-grow:1;flex-grow:1;}
.f_between{-webkit-justify-content:space-between;justify-content:space-between;}
.t_perfect{position:relative;}
.t_perfect .tp_content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}
.t_center{text-align:center;}
.t_left{text-align:left;}
.t_right{text-align:right;}
.t_justify{text-align:justify;}
.line_clamp{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.line_clamp.lc1{-webkit-line-clamp:1}

/* CSS Control */
.bg2{background:var(--color2);border:1px solid var(--border);}
.btn{padding:6px 10px;cursor:pointer;background:var(--color5);color:var(--color3);font-size:100%;font-family:Arial;border:0;border-radius:2px;}
.btn:hover,.btn.selected{background-color:#3b5998;}
/* .mobile .btn:not(.red):not(.green):not(.no_hover):hover{background-color:var(--color5);} */
.btn.red,.btn.red:hover,.red{background:#dd584f;color:var(--color3);border-color:#dd584f;}
.btn.green,.btn.green:hover,.green{background:#238636;color:var(--color3);border-color:#238636;}
.btn.bgrey,.btn.bgrey:hover,.bgrey{background-color:#cfd8dc;color:#37474f;border:1px solid #b0bec5;}
button.btn{font-size:90%;}
a.btn{color:var(--color3);}
.btn[disabled]{background-color:var(--color6);color:757575o;}
.max{max-width:768px;margin:0 auto;}
.full,.w_100{width:100%;}
.w_70{width:70%;}
.w_50{width:50%;}
.w_30{width:30%;}
.full_page{width:100% !important;}
.full_img{background:var(--color3);width:100%;height:100%;display:block;padding:2px;border:1px solid var(--border);}
.layer{padding:15px;}
.layer2{padding:0 15px;}
.post_layer{padding:15px 0;}
.radius{overflow:hidden;-webkit-border-radius:5px;border-radius:5px;}
.line{height:2px;border-top:1px solid #d9dde0;border-bottom:1px solid #f9fbfa;}
.new_line{height:12px;}
.nowrap{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}
.pulse{animation:pulse 1s ease infinite alternate;}
.disabled,[disabled]{cursor:not-allowed !important;}

.loading:before,.no-image:before{content:'';position:absolute;top:0;bottom:0;right:0;left:0;}
.loading.lody{position:absolute;width:100%;height:100%;overflow:hidden;}
.loading.lody:before{background:var(--color2);z-index:9998;position:fixed;}
.loading.loge{position:relative;}
.loading.loge:before{background:rgba(243,243,243,.7);}
.loading.loge:after{content:'Loading...';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}

.no-image:before{background-color:var(--color3);}
.no-image:after{content:'no-image';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:80%;}

.no_items{display:none;}
.hidden_items{visibility:hidden;opacity:0;margin:0;padding:0;max-height:0;max-width:0;overflow:hidden;text-indent:-9999px;}

/* Main */
.main{margin:15px auto;position:relative;}
.main .source{position:absolute;top:0;right:0;line-height:0;padding-right:15px;}
.footer{margin-bottom:20px;}
.footer .message{margin:0 0 20px;}
/* .footer a{color:var(--color4);} */

/* Post Wrapper */
.post-header{margin:0 0 30px;}
.post-content .scrap-submit{margin:20px 0 5px;}
.post-content .scrap-result{margin-top:15px;}
.post-content .scrap-result .result-url a{word-wrap:break-word;}
.post-content .scrap-result .result-code{margin:15px 0 25px;}
.post-content .scrap-result .result-code .result-bottom{padding-top:10px;font-size:200%;}
.post-content .scrap-result .result-code .result-ok{color:#238636;}
.post-content .scrap-result .result-code .result-ok .code{vertical-align:middle;}
.post-content .scrap-result .result-code .result-ok .bypass{font-size:80%;}

@keyframes pulse {
  0%{box-shadow:0 0 0 0px #dc3545;}
  100%{box-shadow:0 0 0 4px #dc3545;}
}

/* #===========================================================================================#  */

/* Dark Mode */
@media (prefers-color-scheme: dark) {
  body {
    --color: #222;
    --color2: #2a2a2a;
    --color4: #bbb;
    --color6: #333;
    --border: #444;
  }

  .loading.loge:before{background-color:rgba(0,0,0,.7);}
  input[type=text],input[type=number],textarea,select{background-color:#282828;color:var(--color4);}
}

/* #===========================================================================================#  */

/* Desktop */
@media screen and (min-width:481px) {
.main{margin-top:30px;}
}

/* Mobile */
@media screen and (max-width:768px) {
  body{font-size:18px;line-height:1.5em;}
  h1{font-size:110%;}
  h2{font-size:100%;}
  /* .layer{padding:20px 25px;} */
  /* .layer2{padding:0 25px;} */

  .main{padding:20px 25px;}
}

@media screen and (max-width:480px) {
  .post-content .scrap-result .result-url .result-bottom{font-size:90%;}
}
</style>
</head>
<body>

<div class="main max layer ">
  <div class="post-wrapper">
    <div class="post-header t_center"><h1 class="title"><a href="./">Web Scraping Test</a></h1></div>
    <div class="post-content bg2 layer radius">
      <input class="scrap-url full" type="text" placeholder="URL">
      <button type="submit" class="scrap-submit btn full">Check</button>
      <div class="scrap-result t_center no_items">
        <div class="result-url">
          <div class="result-top">Url:</div>
          <div class="result-bottom"><a href="" rel="nofollow" target="_blank"></a></div>
        </div>
        <div class="result-code">
          <div class="result-top">Status Code:</div>
          <div class="result-bottom"><span class="code"><strong></strong></span><span class="bypass"></span></div>
        </div>
        <div class="result-xml">
          <textarea class="full" style="min-height:150px;" readonly></textarea>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
// Simple querySelector https://codepen.io/sekedus/pen/oKYOEK
function el(e,l,m) {
  var elem, parent = l != 'all' && l != 'xpath' && (l || l === null) ? l : document;
  if (parent === null) {
    elem = parent;
    console.error('selector: '+ e +' => parent: '+ parent);
  } else {
    if ((m || l) == 'xpath') {
      // https://stackoverflow.com/a/14284815
      elem = document.evaluate(e, parent, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
    } else {
      elem = ((m || l) == 'all') ? parent.querySelectorAll(e) : parent.querySelector(e);
    }
  }
  return elem;
}

// Check if string is URL https://stackoverflow.com/a/49849482
function isValidUrl(string) {
  // regex = https://gist.github.com/dperini/729294
  var res = string.match(/^(?:(?:(?:https?|ftp):)?\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i);
  return (res !== null);
}

// loadXMLDoc (XMLHttpRequest) https://codepen.io/sekedus/pen/vYGYBNP
function loadXMLDoc(url, callback, info) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
      var response = this.responseText;
      if (this.status == 200) {
        if (info == 'parse') {
          var resHTML = new DOMParser();
          response = resHTML.parseFromString(response, 'text/html');
        }
      } else {
        var err_msg = '!! ERROR: loadXMLDoc status = '+ this.status +', url = '+ url;
        console.error(err_msg);
        if (response == '') response = err_msg;
      }
      callback({"status": this.status, "response": response});
    }
  };
  xhr.open('GET', url, true);
  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
  xhr.send();
}

function scrap_show(data) {
  window['wst_data'] = JSON.parse(data.response);
  // console.log('wst_data:', wst_data);
  var err = 'error' in wst_data ? wst_data.error : false;
  el('.post-content').classList.remove('loading', 'loge');
  el('.result-url a').href = wst_data.url.search(/(https?:)?\/\//) == -1 ? ('//'+ wst_data.url) : wst_data.url;
  el('.result-url a').innerHTML = wst_data.url;
  el('.result-code .code strong').innerHTML = wst_data.status_code;
  el('.result-code .bypass').innerHTML = !err && wst_data.bypass ? ' (bypass)' : '';
  if (wst_data.status_code == 200) el('.result-code .result-bottom').classList.add('result-ok');
  el('.result-xml textarea').value = err ? ('❗❗ Error:\n\n'+ err.message +' in '+ err.file +' on line '+ err.line) : wst_data.body;
  el('.scrap-result').classList.remove('no_items');
  el('.result-xml textarea').scrollTop = 0;
}

el('.scrap-submit').addEventListener('click', function() {
  var url = el('.scrap-url').value;
  if (url.search(/^(https?|ftp):/) == -1) url = 'http://'+ url.replace(/^\/\//, '');
  if (url == '') {
    el('.scrap-url').focus();
    return;
  }
  if (!isValidUrl(url)) {
    alert('Invalid URL');
    el('.scrap-url').select();
    return;
  }
  el('.post-content').classList.add('loading', 'loge');
  el('.scrap-result').classList.add('no_items');
  el('.result-code .result-bottom').classList.remove('result-ok');
  loadXMLDoc('./test.php?url='+ encodeURIComponent(url), scrap_show);
});

el('.result-xml textarea').addEventListener('dblclick', function () {
  this.select();
});

document.addEventListener('keyup', function(e) {
  if (e.code == 'Enter' || e.keyCode == 13) el('.scrap-submit').click();
});
</script>
</body>
</html>
